[
  {
    "objectID": "index.html",
    "href": "index.html",
    "title": "Salmonella Biofilm Formation Stuff",
    "section": "",
    "text": "A living document containing current results for the Salmonella biofilm prediction project."
  },
  {
    "objectID": "testing.html",
    "href": "testing.html",
    "title": "Biofilm data EDA",
    "section": "",
    "text": "Loading libraries, helper functions, setting themes\nlibrary(tidyverse)\nlibrary(readxl)\nlibrary(MetBrewer)\nlibrary(ggtext)\nlibrary(ggridges)\n\ntheme_set(\n    theme_light() +\n        theme(\n            panel.grid.minor = element_blank(),\n            strip.text = element_text(color = \"black\", size = 12),\n            strip.background = element_rect(fill = \"gray80\"),\n            panel.border = element_blank()\n        )\n)\n\n1serotype_labeller &lt;- function(variable) {\n    total_count &lt;- table(samples_df$serotype)[variable]\n    paste0(variable, \" (n = \", total_count, \")\")\n}\n\n2nice_expansion &lt;- expansion(add = 0, mult = c(0, 0.1))\n\n3plate_labeller &lt;- function(plate_string) {\n    plate_date &lt;- format(as.Date(str_replace(plate_string, \"_72h\", \"\"), format = \"%d%b%y\"), \"%b. %d, %Y\")\n    this_label &lt;- str_sub(plate_string, -1)\n    plate_date &lt;- case_when(\n        this_label %in% c(\"A\", \"B\", \"C\") ~ paste(plate_date, this_label),\n        TRUE ~ plate_date\n    )\n\n    return(plate_date)\n}\n\n4categorize_biofilm_formation &lt;- function(cv_reading, sd_vbe, base = 0) {\n    case_when(\n        cv_reading &lt; base + sd_vbe ~ \"non-former\",\n        between(cv_reading, base + sd_vbe, base + 2 * sd_vbe) ~ \"weak\",\n        between(cv_reading, base + 2 * sd_vbe, base + 4 * sd_vbe) ~ \"moderate\",\n        cv_reading &gt; base + 4 * sd_vbe ~ \"strong\"\n    )\n}\n\n\n\n1\n\nLabeller function to put serovar counts in strip titles when facetting\n\n2\n\nCustom expansion to remove space from beneath continuous values\n\n3\n\nFunction to nicely format plate labels. Example: 01dec23_72h_A becomes Dec. 01, 2023 A\n\n4\n\nCategorizes the biofilm formation on the sample based on Shawn’s scheme."
  },
  {
    "objectID": "testing.html#od-distributions",
    "href": "testing.html#od-distributions",
    "title": "Biofilm data EDA",
    "section": "OD Distributions",
    "text": "OD Distributions\nDistribution of mean OD across all samples.\n\n\nHistogram of mean OD over all samples.\nthese_breaks &lt;- seq(0, 2.5, by = 0.1)\nodc_breaks &lt;- mean(vbe_summaries$sd_vbe) * c(1, 2, 4)\nsamples_df %&gt;%\n    ggplot(aes(mean)) +\n    geom_histogram(\n        fill = \"#CECECE\",\n        color = \"black\",\n        breaks = these_breaks\n    ) +\n    scale_y_continuous(expand = nice_expansion) +\n    scale_x_continuous(\n        breaks = these_breaks[c(TRUE, FALSE)],\n        expand = nice_expansion\n    ) +\n    geom_vline(\n        xintercept = odc_breaks,\n        color = \"red\",\n    ) +\n    theme(\n        panel.grid.major.x = element_blank(),\n        plot.title = element_text(size = 16, face = \"bold\", hjust = 0.5),\n    ) +\n    labs(\n        x = \"Mean OD\",\n        y = \"# Samples\",\n        title = \"Distribution of mean ODs in samples\"\n    )\n\n\n\n\n\n\n\n\nFigure 1: Distribution of mean ODs. Dashed red vertical lines indicate mean \\(OD_c\\), \\(2OD_c\\), and \\(4OD_c\\).\n\n\n\n\n\nDistribution of mean OD by serotype\n\n\nHistogram of mean OD by serotype\nsamples_df %&gt;%\n    ggplot(aes(mean)) +\n    geom_histogram() +\n    scale_y_continuous(expand = nice_expansion) +\n    theme(\n        panel.grid.major.x = element_blank(),\n        plot.title = element_text(size = 16, face = \"bold\", hjust = 0.5),\n    ) +\n    labs(\n        x = \"Mean OD\",\n        y = \"# Samples\",\n        title = \"Distribution of mean ODs in samples\"\n    ) +\n    facet_wrap(\n        ~serotype\n    ) +\n    geom_vline(\n        data = samples_df %&gt;%\n            group_by(serotype) %&gt;%\n            summarise(\n                mean = mean(mean)\n            ),\n        aes(xintercept = mean),\n        color = \"red\",\n        linetype = \"dashed\"\n    )\n\n\n\n\n\n\n\n\nFigure 2: Distribution of mean ODs by serotype. Dashed red vertical line indicates overall mean OD within that serotype.\n\n\n\n\n\nWe can perhaps see some differnces in mean OD by serotype:\n\n\nBoxplot\nsamples_df %&gt;%\n    ggplot(aes(serotype, mean)) +\n    geom_boxplot()\n\n\n\n\n\n\n\n\n\nWe’ll test for significant differences in mean OD by serotype using ANOVA.\n\n\nANOVA\nanova_results &lt;- aov(\n    mean ~ serotype,\n    data = samples_df\n)\n\nsummary(anova_results)\n\n\n             Df Sum Sq Mean Sq F value   Pr(&gt;F)    \nserotype      3  11.17   3.722   20.69 5.25e-13 ***\nResiduals   987 177.56   0.180                     \n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n\n\nANOVA shows that mean OD significantly differs based on Serotype (\\(p \\approx 4.41e-10\\)). We’ll use a Tukey post-hoc test to determine where these significant differences are. Since TukeyHSD already does multiple testing correction, we’ll just use \\(\\alpha = 0.05\\) here.\n\n\nTukeyHSD\ntukey_results &lt;- TukeyHSD(anova_results)\n\np_thresh &lt;- 0.05\n\ntukey_results$serotype %&gt;%\n    as.data.frame() %&gt;%\n    janitor::clean_names() %&gt;%\n    rownames_to_column(\"contrast\") %&gt;%\n    filter(p_adj &lt; p_thresh) %&gt;%\n    select(contrast, p_adj)\n\n\n                  contrast        p_adj\n1  Heidelberg-4,[5],12:i:- 5.210610e-12\n2    Infantis-4,[5],12:i:- 4.502361e-08\n3 Typhimurium-4,[5],12:i:- 1.323608e-03\n4   Typhimurium-Heidelberg 1.514366e-03\n\n\nSo we see that all comparisons are significant at \\(\\alpha = 0.05\\), with some comparisons being more statistically significant than others."
  },
  {
    "objectID": "testing.html#writing-out-prepped-sample-data",
    "href": "testing.html#writing-out-prepped-sample-data",
    "title": "Biofilm data EDA",
    "section": "Writing out prepped sample data",
    "text": "Writing out prepped sample data\n\n\nCode\nplot(tukey_results)\n\n\n\n\n\n\n\n\n\n\nSome scratch\n\n\nPlotting mean OD and standard deviation by plate\nvbe_summaries %&gt;%\n    ggplot(aes(plate_label, mean_vbe)) +\n    geom_point() +\n    geom_errorbar(aes(ymin = mean_vbe - sd_vbe, ymax = mean_vbe + sd_vbe), width = 0.2) +\n    theme(\n        panel.grid.major.x = element_blank(),\n        axis.text.x = element_text(angle = 90, vjust = 0.5, hjust = 1)\n    )\n\n\n\n\n\nMean \\(OD_538\\) and standard deviation of \\(OD_538\\) by plate\n\n\n\n\n\n\nCode\nvbe_summaries %&gt;%\n    mutate(\n        biofilm_sd = n_vbe * sd_vbe\n    ) %&gt;%\n    pivot_longer(\n        contains(\"sd\")\n    ) %&gt;%\n    ggplot(aes(value)) +\n    geom_histogram() +\n    facet_wrap(~name, scales = \"free\") +\n    theme(\n        panel.grid.major.x = element_blank(),\n    ) +\n    scale_y_continuous(expand = nice_expansion)\n\n\n\n\n\nHistogram of SDs * n for each plate.\n\n\n\n\n\n\nCode\nsamples_df %&gt;%\n    left_join(\n        vbe_summaries,\n        by = c(\"x72_hr_plate\" = \"x72_hr_plate\")\n    ) %&gt;%\n    mutate(\n        biofilm_category = categorize_biofilm_formation(mean, sqrt(n_vbe) * sd_vbe)\n    ) %&gt;%\n    count(biofilm_category)\n\n\n# A tibble: 4 × 2\n  biofilm_category     n\n  &lt;chr&gt;            &lt;int&gt;\n1 moderate            46\n2 non-former          13\n3 strong             917\n4 weak                15\n\n\nCode\n# mutate(biofilm_sd = n_vbe * sd_vbe) %&gt;%\n#     ggplot(aes())\n\n\n\n\nCode\nsamples_df %&gt;%\n    left_join(\n        vbe_summaries,\n        by = c(\"x72_hr_plate\" = \"x72_hr_plate\")\n    ) %&gt;%\n    mutate(\n        across(\n            starts_with(\"cv_\"),\n            ~ categorize_biofilm_formation(., 3 * sd_vbe),\n            .names = \"biofilm_{.col}\"\n        ),\n    ) %&gt;%\n    count(biofilm_cv_1_od538, biofilm_cv_2_od538)\n\n\n# A tibble: 1 × 3\n  biofilm_cv_1_od538 biofilm_cv_2_od538     n\n  &lt;chr&gt;              &lt;chr&gt;              &lt;int&gt;\n1 strong             strong               991\n\n\n\n\nCode\nmean(vbe_summaries$n_vbe)\n\n\n[1] 31.78261\n\n\n\n\nDistribution of differences between samples\n\n\nCode\nsamples_df %&gt;%\n    mutate(sample_diff = cv_1_od538 - cv_2_od538) %&gt;%\n    ggplot(aes(sample_diff)) +\n    geom_histogram(color = \"black\", fill = \"#CECECE\") +\n    labs(\n        x = \"Difference in OD\",\n        y = \"# Samples\",\n        title = \"Difference in OD between replicates\"\n    ) +\n    scale_y_continuous(expand = nice_expansion) +\n    theme(\n        panel.grid.major.x = element_blank(),\n        plot.title = element_text(size = 16, face = \"bold\", hjust = 0.5),\n    )\n\n\n\n\n\n\n\n\n\n\n\nPositive controls\n\n\nCode\npositive_controls &lt;- sbfp_data %&gt;%\n    filter(str_detect(source_id, \"^SX240\")) %&gt;%\n    mutate(plate_name = str_replace(x72_hr_plate, \"_72h.*\", \"\")) %&gt;%\n    pivot_longer(\n        starts_with(\"cv_\")\n    ) %&gt;%\n    group_by(plate_name) %&gt;%\n    summarise(\n        mean_cv = mean(value),\n        sd_cv = sd(value),\n        n = n()\n    ) %&gt;%\n    mutate(\n        sample_date = as.Date(plate_name, format = \"%d%b%y\")\n    )\n\noverall_sx240_mean &lt;- sbfp_data %&gt;%\n    filter(str_detect(source_id, \"^SX240\")) %&gt;%\n    pivot_longer(\n        starts_with(\"cv_\")\n    ) %&gt;%\n    pull(value) %&gt;%\n    mean()\n\noverall_sx240_sd &lt;- sbfp_data %&gt;%\n    filter(str_detect(source_id, \"^SX240\")) %&gt;%\n    pivot_longer(\n        starts_with(\"cv_\")\n    ) %&gt;%\n    pull(value) %&gt;%\n    sd()\n\n\n\n\nCode\nsbfp_data %&gt;%\n    filter(str_detect(source_id, \"^SX240\")) %&gt;%\n    view()\n\n\n\n\nStandard deviations\n\n\nCode\nall_sds &lt;- bind_rows(\n    data.frame(\n        sd_cv = positive_controls$sd_cv,\n        type = \"sx240\"\n    ),\n    data.frame(\n        sd_cv = samples_df$std_dev,\n        type = \"samples\"\n    )\n)\n\noverall_mean_sd &lt;- mean(all_sds$sd_cv)\noverall_sd_sd &lt;- sd(all_sds$sd_cv)\n\nvline_breaks &lt;- c(-2, -1, 1, 2) * overall_sd_sd + overall_mean_sd\nsd_labels &lt;- data.frame(\n    y = vline_breaks,\n    label = c(\n        \"-2 SD\", \"-1 SD\", \"+1 SD\", \"+2 SD\"\n    )\n)\n\nall_sds %&gt;%\n    arrange(sd_cv) %&gt;%\n    mutate(id = row_number()) %&gt;%\n    ggplot(aes(id, sd_cv)) +\n    geom_hline(\n        yintercept = vline_breaks[2:4],\n        linetype = \"dashed\",\n        color = \"gray50\"\n    ) +\n    geom_hline(\n        yintercept = overall_mean_sd,\n        color = \"black\",\n        linewidth = 1.5,\n        linetype = \"dashed\"\n    ) +\n    geom_point(\n        aes(\n            size = if_else(type == \"sx240\", 6, 1),\n            fill = type,\n            alpha = if_else(type == \"sx240\", 1, 0.5),\n        ),\n        shape = 21,\n    ) +\n    scale_y_continuous(expand = nice_expansion) +\n    scale_x_continuous(expand = nice_expansion) +\n    theme(\n        panel.grid.major.x = element_blank(),\n        axis.ticks = element_blank(),\n        axis.text.x = element_blank(),\n        plot.title = element_text(hjust = 0.5, size = 14),\n        axis.line.x = element_line(color = \"black\", linewidth = 0.5),\n    ) +\n    geom_text(\n        data = sd_labels %&gt;% slice_tail(n = 3),\n        aes(nrow(all_sds), y, label = label),\n        inherit.aes = FALSE,\n        nudge_y = 0.02\n    ) +\n    geom_text(\n        data = NULL,\n        inherit.aes = FALSE,\n        aes(nrow(all_sds), overall_mean_sd + 0.02, label = \"Overall mean SD\")\n    ) +\n    scale_fill_manual(values = met.brewer(\"Kandinsky\")) +\n    labs(\n        x = \"\",\n        y = \"Standard deviation\",\n        fill = \"\",\n        title = \"Standard deviations of CV readings\",\n    ) +\n    guides(\n        size = \"none\",\n        alpha = \"none\"\n    )\n\n\n\n\n\n\n\n\n\n\n\nQQ plot of SDs\n\n\nCode\nqqnorm(all_sds$sd_cv)\nqqline(all_sds$sd_cv)\n\n\n\n\n\n\n\n\n\n\n\nChecking missing samples\n\n\nCode\nars_missing_isolates &lt;- read_xlsx(\"data/ARS requested isolates copy.xlsx\") %&gt;%\n    janitor::clean_names() %&gt;%\n    filter(is.na(box)) %&gt;%\n    rename(source_id = text_id)\n\nmissing_isolates_from_metadata &lt;- anti_join(\n    metadata,\n    samples_df,\n    by = c(\"sample\" = \"sample\")\n)\n\n\n\n\nCode\nmissing_isolates_from_metadata %&gt;%\n    filter(!sample %in% ars_missing_isolates$source_id) %&gt;%\n    pull(sample)\n\n\n[1] \"18-038875-007\" \"18-038877-080\"\n\n\n\n\nCode\nars_missing_isolates %&gt;%\n    filter(!source_id %in% missing_isolates_from_metadata$sample) %&gt;%\n    pull(source_id)\n\n\n[1] \"18-012180-609\"\n\n\n\n\nCode\nmetadata %&gt;%\n    filter(sample %in% c(\"18-038875-007\", \"18-038877-080\"))\n\n\n# A tibble: 2 × 3\n  sample        source_species serotype    \n  &lt;chr&gt;         &lt;chr&gt;          &lt;chr&gt;       \n1 18-038875-007 Pig            4,[5],12:i:-\n2 18-038877-080 Sheep          Heidelberg  \n\n\n\n\nCode\nsamples_df %&gt;%\n    filter(sample %in% c(\"18-038875-007\", \"18-038877-080\"))\n\n\n# A tibble: 0 × 18\n# ℹ 18 variables: sample &lt;chr&gt;, source_species &lt;chr&gt;, serotype &lt;chr&gt;,\n#   initial_incubation_plate_24hrs &lt;chr&gt;, well &lt;chr&gt;, nvsl_id &lt;chr&gt;,\n#   starting_od600_vbe_blank &lt;chr&gt;,\n#   how_much_sample_to_add_biofilm_inc_ml &lt;dbl&gt;,\n#   how_much_vbe_to_add_biofilm_inc_500_ml_tv &lt;dbl&gt;, x72_hr_plate &lt;chr&gt;,\n#   plate_1_well_72hr_incubation &lt;chr&gt;, cv_1_od538 &lt;dbl&gt;,\n#   blank_1_od538_538 &lt;dbl&gt;, plate_2_well_72hr_incubation &lt;chr&gt;, …\n\n\n\n\nCode\nanti_join(\n    samples_df,\n    metadata,\n    by = c(\"sample\" = \"sample\")\n)\n\n\n# A tibble: 0 × 18\n# ℹ 18 variables: sample &lt;chr&gt;, source_species &lt;chr&gt;, serotype &lt;chr&gt;,\n#   initial_incubation_plate_24hrs &lt;chr&gt;, well &lt;chr&gt;, nvsl_id &lt;chr&gt;,\n#   starting_od600_vbe_blank &lt;chr&gt;,\n#   how_much_sample_to_add_biofilm_inc_ml &lt;dbl&gt;,\n#   how_much_vbe_to_add_biofilm_inc_500_ml_tv &lt;dbl&gt;, x72_hr_plate &lt;chr&gt;,\n#   plate_1_well_72hr_incubation &lt;chr&gt;, cv_1_od538 &lt;dbl&gt;,\n#   blank_1_od538_538 &lt;dbl&gt;, plate_2_well_72hr_incubation &lt;chr&gt;, …\n\n\n\n\nCode\nsbfp_data %&gt;%\n    filter(str_detect(source_id, \"18-|19-\"))\n\n\n# A tibble: 991 × 16\n   initial_incubation_plate_24hrs well  source_id nvsl_id starting_od600_vbe_b…¹\n   &lt;chr&gt;                          &lt;chr&gt; &lt;chr&gt;     &lt;chr&gt;   &lt;chr&gt;                 \n 1 02nov23_24h_A                  B02   18-01218… NVSL02… 9.8000000000000004E-2 \n 2 02nov23_24h_A                  B03   18-01218… NVSL02… 0.11700000000000001   \n 3 02nov23_24h_A                  B04   18-01218… NVSL02… 0.11                  \n 4 02nov23_24h_A                  B05   18-01218… NVSL02… 0.107                 \n 5 02nov23_24h_A                  B06   18-01218… NVSL02… 7.2999999999999995E-2 \n 6 02nov23_24h_A                  B07   18-01218… NVSL02… 5.8999999999999997E-2 \n 7 02nov23_24h_A                  B08   18-01218… NVSL02… 0.129                 \n 8 02nov23_24h_A                  B09   18-01218… NVSL02… 7.3999999999999996E-2 \n 9 02nov23_24h_A                  B10   18-01218… NVSL02… 7.8E-2                \n10 02nov23_24h_A                  B11   18-01218… NVSL02… 0.11799999999999999   \n# ℹ 981 more rows\n# ℹ abbreviated name: ¹​starting_od600_vbe_blank\n# ℹ 11 more variables: how_much_sample_to_add_biofilm_inc_ml &lt;dbl&gt;,\n#   how_much_vbe_to_add_biofilm_inc_500_ml_tv &lt;dbl&gt;, x72_hr_plate &lt;chr&gt;,\n#   plate_1_well_72hr_incubation &lt;chr&gt;, cv_1_od538 &lt;dbl&gt;,\n#   blank_1_od538_538 &lt;dbl&gt;, plate_2_well_72hr_incubation &lt;chr&gt;,\n#   cv_2_od538 &lt;dbl&gt;, blank_2_od538_538 &lt;dbl&gt;, mean &lt;dbl&gt;, std_dev &lt;dbl&gt;\n\n\n\n\nCode\nrecent_metadata &lt;- read_xlsx(\"data/nvsl_fsep_salmonella_collection.xlsx\") %&gt;%\n    janitor::clean_names() %&gt;%\n    rename(source_id = nvsl_internal_id)\n\n\n\n\nCode\nrecent_metadata %&gt;%\n    filter(source_id %in% ars_missing_isolates$source_id)\n\n\n# A tibble: 1 × 7\n  collection_id source_id     serotype source_species nvsl_box nvsl_box_slot\n  &lt;chr&gt;         &lt;chr&gt;         &lt;chr&gt;    &lt;chr&gt;          &lt;chr&gt;    &lt;chr&gt;        \n1 NVSL0470      18-012180-609 UNKNOWN  UNKNOWN        UNKNOWN  UNKNOWN      \n# ℹ 1 more variable: fsep_date_received &lt;dttm&gt;\n\n\n\n\nCode\n# For every\n# for (samp in samples_df$sample) {\n#     if (length(list.files(\"data/all_genomes\", pattern = paste0(\"^\", samp))) == 0) {\n#         print(samp)\n#     }\n# }\n\n\n\n\nCode\ninner_join(\n    metadata,\n    sbfp_data,\n    by = c(\"sample\" = \"source_id\")\n) %&gt;%\n    filter(!is.na(mean))\n\n\n# A tibble: 991 × 18\n   sample        source_species serotype    initial_incubation_p…¹ well  nvsl_id\n   &lt;chr&gt;         &lt;chr&gt;          &lt;chr&gt;       &lt;chr&gt;                  &lt;chr&gt; &lt;chr&gt;  \n 1 18-006979-001 Pig            Typhimurium 12oct23_24h_A          B02   NVSL00…\n 2 18-006979-002 Pig            Heidelberg  12oct23_24h_A          B03   NVSL00…\n 3 18-006979-004 Turkey         Typhimurium 12oct23_24h_A          B04   NVSL00…\n 4 18-006979-005 Chicken        Heidelberg  12oct23_24h_A          B05   NVSL00…\n 5 18-006979-010 Pig            Heidelberg  12oct23_24h_A          B06   NVSL00…\n 6 18-006979-014 Horse          4,[5],12:i… 12oct23_24h_A          B07   NVSL00…\n 7 18-006979-015 Pig            Typhimurium 12oct23_24h_A          B08   NVSL00…\n 8 18-006979-016 Horse          Typhimurium 12oct23_24h_A          B09   NVSL00…\n 9 18-006979-021 Pig            Heidelberg  12oct23_24h_A          B10   NVSL00…\n10 18-006979-023 Pig            Heidelberg  12oct23_24h_A          B11   NVSL00…\n# ℹ 981 more rows\n# ℹ abbreviated name: ¹​initial_incubation_plate_24hrs\n# ℹ 12 more variables: starting_od600_vbe_blank &lt;chr&gt;,\n#   how_much_sample_to_add_biofilm_inc_ml &lt;dbl&gt;,\n#   how_much_vbe_to_add_biofilm_inc_500_ml_tv &lt;dbl&gt;, x72_hr_plate &lt;chr&gt;,\n#   plate_1_well_72hr_incubation &lt;chr&gt;, cv_1_od538 &lt;dbl&gt;,\n#   blank_1_od538_538 &lt;dbl&gt;, plate_2_well_72hr_incubation &lt;chr&gt;, …"
  },
  {
    "objectID": "about.html",
    "href": "about.html",
    "title": "About",
    "section": "",
    "text": "About this site"
  }
]